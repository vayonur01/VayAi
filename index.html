<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Chatbot</title>
  <style>
    body { font-family: Arial; background:#f4f4f4; }
    #box { width:400px; margin:40px auto; background:#fff; padding:10px; }
    textarea { width:100%; height:60px; }
    button { width:100%; margin-top:5px; }
    #chat { margin-top:10px; }
  </style>
</head>
<body>

<div id="box">
  <h3>Chatbot</h3>
  <textarea id="input" placeholder="Mesaj yaz"></textarea>
  <button id="sendBtn" disabled>API y√ºkleniyor...</button>
  <div id="chat"></div>
</div>

<script>
let OPENAI_API_KEY = "";

// üî• api.env DOSYASINDAN KEY OKU
fetch("api.env?v=" + Date.now())
  .then(res => {
    if (!res.ok) throw new Error("api.env okunamadƒ±");
    return res.text();
  })
  .then(key => {
    OPENAI_API_KEY = key.trim();
    document.getElementById("sendBtn").disabled = false;
    document.getElementById("sendBtn").textContent = "G√∂nder";
  })
  .catch(err => {
    document.getElementById("sendBtn").textContent = "API y√ºklenemedi";
    console.error(err);
  });

document.getElementById("sendBtn").onclick = send;

async function send() {
  if (!OPENAI_API_KEY) {
    alert("API KEY hen√ºz y√ºklenmedi!");
    return;
  }

  const input = document.getElementById("input");
  const chat = document.getElementById("chat");

  if (!input.value) return;

  chat.innerHTML += "<b>Sen:</b> " + input.value + "<br>";

  const res = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer " + OPENAI_API_KEY
    },
    body: JSON.stringify({
      model: "gpt-4o-mini",
      messages: [
        { role: "system", content: "Sen yardƒ±mcƒ± bir chatbotsun" },
        { role: "user", content: input.value }
      ]
    })
  });

  const data = await res.json();

  if (data.error) {
    chat.innerHTML += "<b>Hata:</b> " + data.error.message + "<br>";
  } else {
    chat.innerHTML += "<b>Bot:</b> " + data.choices[0].message.content + "<br>";
  }

  input.value = "";
}
</script>

</body>
</html>
